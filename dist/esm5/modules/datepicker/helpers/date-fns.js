import * as tslib_1 from "tslib";
import { format, parse } from "date-fns";
import * as defaultLocale from "date-fns/locale/en-US";
function buildLocalizeFn(values, defaultType, indexCallback) {
    return function (dirtyIndex, _a) {
        var type = (_a === void 0 ? { type: defaultType } : _a).type;
        var index = indexCallback ? indexCallback(dirtyIndex) : dirtyIndex;
        /* There might be a better way to fix this error:
        ----
        src/modules/datepicker/helpers/date-fns.ts:43:23 - error TS2538: Type 'undefined' cannot be used as an index type.

        43         return values[type][index];
        ----
            However, this '|| 1' coercion "works"
        */
        return values[type || -1][index];
    };
}
function buildLocalizeArrayFn(values, defaultType) {
    return function (_a) {
        var type = (_a === void 0 ? { type: defaultType } : _a).type;
        return values[type || -1];
    };
}
function buildMatchFn(patterns, defaultType) {
    return function (dirtyString, _a) {
        var type = (_a === void 0 ? { type: defaultType } : _a).type;
        return dirtyString.match("^(" + patterns[type || -1].join("|") + ")");
    };
}
function buildParseFn(patterns, defaultType) {
    return function (_a, _b) {
        var _c = tslib_1.__read(_a, 2), result = _c[1];
        var type = (_b === void 0 ? { type: defaultType } : _b).type;
        return (patterns[type || -1] || patterns[defaultType])
            .map(function (p) { return new RegExp("^" + p); })
            .findIndex(function (pattern) { return pattern.test(result); });
    };
}
var DateFnsParser = /** @class */ (function () {
    function DateFnsParser(locale) {
        this._weekStartsOn = locale.firstDayOfWeek;
        var weekdayValues = {
            long: locale.weekdays,
            short: locale.weekdaysShort,
            narrow: locale.weekdaysNarrow
        };
        var monthValues = {
            long: locale.months,
            short: locale.monthsShort
        };
        var timeOfDayValues = {
            long: locale.timesOfDay,
            uppercase: locale.timesOfDayUppercase,
            lowercase: locale.timesOfDayLowercase
        };
        var timeOfDayMatchValues = {
            long: locale.timesOfDay,
            short: locale.timesOfDayUppercase.concat(locale.timesOfDayLowercase)
        };
        this._locale = defaultLocale;
        this._locale.localize = tslib_1.__assign({}, this._locale.localize, {
            weekday: buildLocalizeFn(weekdayValues, "long"),
            weekdays: buildLocalizeArrayFn(weekdayValues, "long"),
            month: buildLocalizeFn(monthValues, "long"),
            months: buildLocalizeArrayFn(monthValues, "long"),
            timeOfDay: buildLocalizeFn(timeOfDayValues, "long", function (hours) {
                return hours / 12 >= 1 ? 1 : 0;
            }),
            timesOfDay: buildLocalizeArrayFn(timeOfDayValues, "long")
        });
        this._locale.match = tslib_1.__assign({}, this._locale.match, {
            weekdays: buildMatchFn(weekdayValues, "long"),
            weekday: buildParseFn(weekdayValues, "long"),
            months: buildMatchFn(monthValues, "long"),
            month: buildParseFn(monthValues, "long"),
            timesOfDay: buildMatchFn(timeOfDayMatchValues, "long"),
            timeOfDay: buildParseFn(timeOfDayMatchValues, "long")
        });
    }
    Object.defineProperty(DateFnsParser.prototype, "_config", {
        get: function () {
            return {
                weekStartsOn: this._weekStartsOn,
                locale: this._locale
            };
        },
        enumerable: true,
        configurable: true
    });
    DateFnsParser.prototype.format = function (d, f) {
        return format(d, f, this._config);
    };
    DateFnsParser.prototype.parse = function (dS, f, bD) {
        return parse(dS, f, bD, this._config);
    };
    return DateFnsParser;
}());
export { DateFnsParser };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1mbnMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzItc2VtYW50aWMtdWkvIiwic291cmNlcyI6WyJtb2R1bGVzL2RhdGVwaWNrZXIvaGVscGVycy9kYXRlLWZucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDekMsT0FBTyxLQUFLLGFBQWEsTUFBTSx1QkFBdUIsQ0FBQztBQWlDdkQsU0FBUyxlQUFlLENBQ3BCLE1BQTJCLEVBQzNCLFdBQWtCLEVBQ2xCLGFBQTBDO0lBRTFDLE9BQU8sVUFBQyxVQUFpQixFQUFFLEVBQWdDO1lBQTlCLHdEQUFJO1FBQzdCLElBQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7UUFDckU7Ozs7Ozs7VUFPRTtRQUNGLE9BQU8sTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFTLG9CQUFvQixDQUN6QixNQUEyQixFQUMzQixXQUFrQjtJQUVsQixPQUFPLFVBQUMsRUFBZ0M7WUFBOUIsd0RBQUk7UUFBK0IsT0FBQSxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQWxCLENBQWtCLENBQUM7QUFDcEUsQ0FBQztBQUVELFNBQVMsWUFBWSxDQUNqQixRQUE2QixFQUM3QixXQUFrQjtJQUVsQixPQUFPLFVBQUMsV0FBVyxFQUFFLEVBQWdDO1lBQTlCLHdEQUFJO1FBQ3ZCLE9BQUEsV0FBVyxDQUFDLEtBQUssQ0FBQyxPQUFLLFFBQVEsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQUcsQ0FBQztJQUF6RCxDQUF5RCxDQUFDO0FBQ2xFLENBQUM7QUFFRCxTQUFTLFlBQVksQ0FDakIsUUFBNkIsRUFDN0IsV0FBa0I7SUFFbEIsT0FBTyxVQUFDLEVBQVUsRUFBRSxFQUFnQztZQUE1QywwQkFBVSxFQUFQLGNBQU07WUFBSyx3REFBSTtRQUN0QixPQUFBLENBQUMsUUFBUSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQzthQUMxQyxHQUFHLENBQUMsVUFBQyxDQUFRLElBQUssT0FBQSxJQUFJLE1BQU0sQ0FBQyxNQUFJLENBQUcsQ0FBQyxFQUFuQixDQUFtQixDQUFDO2FBQ3RDLFNBQVMsQ0FBQyxVQUFDLE9BQWMsSUFBSyxPQUFBLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQXBCLENBQW9CLENBQUM7SUFGeEQsQ0FFd0QsQ0FBQztBQUNqRSxDQUFDO0FBRUQ7SUFXSSx1QkFBWSxNQUE4QjtRQUN0QyxJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxjQUFxQyxDQUFDO1FBRWxFLElBQU0sYUFBYSxHQUFHO1lBQ2xCLElBQUksRUFBRSxNQUFNLENBQUMsUUFBUTtZQUNyQixLQUFLLEVBQUUsTUFBTSxDQUFDLGFBQWE7WUFDM0IsTUFBTSxFQUFFLE1BQU0sQ0FBQyxjQUFjO1NBQ2hDLENBQUM7UUFFRixJQUFNLFdBQVcsR0FBRztZQUNoQixJQUFJLEVBQUUsTUFBTSxDQUFDLE1BQU07WUFDbkIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxXQUFXO1NBQzVCLENBQUM7UUFFRixJQUFNLGVBQWUsR0FBRztZQUNwQixJQUFJLEVBQUUsTUFBTSxDQUFDLFVBQVU7WUFDdkIsU0FBUyxFQUFFLE1BQU0sQ0FBQyxtQkFBbUI7WUFDckMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxtQkFBbUI7U0FDeEMsQ0FBQztRQUVGLElBQU0sb0JBQW9CLEdBQUc7WUFDekIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxVQUFVO1lBQ3ZCLEtBQUssRUFBRSxNQUFNLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQztTQUN2RSxDQUFDO1FBRUYsSUFBSSxDQUFDLE9BQU8sR0FBRyxhQUFvQixDQUFDO1FBQ3BDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSx3QkFDZCxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFDckI7WUFDQyxPQUFPLEVBQUUsZUFBZSxDQUFDLGFBQWEsRUFBRSxNQUFNLENBQUM7WUFDL0MsUUFBUSxFQUFFLG9CQUFvQixDQUFDLGFBQWEsRUFBRSxNQUFNLENBQUM7WUFDckQsS0FBSyxFQUFFLGVBQWUsQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDO1lBQzNDLE1BQU0sRUFBRSxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDO1lBQ2pELFNBQVMsRUFBRSxlQUFlLENBQ3RCLGVBQWUsRUFDZixNQUFNLEVBQ04sVUFBQyxLQUFZO2dCQUNULE9BQU8sS0FBSyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLENBQUMsQ0FDSjtZQUNELFVBQVUsRUFBRSxvQkFBb0IsQ0FBQyxlQUFlLEVBQUUsTUFBTSxDQUFDO1NBQzVELENBQ0osQ0FBQztRQUNGLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyx3QkFDWCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFDbEI7WUFDQyxRQUFRLEVBQUUsWUFBWSxDQUFDLGFBQWEsRUFBRSxNQUFNLENBQUM7WUFDN0MsT0FBTyxFQUFFLFlBQVksQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDO1lBQzVDLE1BQU0sRUFBRSxZQUFZLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQztZQUN6QyxLQUFLLEVBQUUsWUFBWSxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUM7WUFDeEMsVUFBVSxFQUFFLFlBQVksQ0FBQyxvQkFBb0IsRUFBRSxNQUFNLENBQUM7WUFDdEQsU0FBUyxFQUFFLFlBQVksQ0FBQyxvQkFBb0IsRUFBRSxNQUFNLENBQUM7U0FDeEQsQ0FDSixDQUFDO0lBQ04sQ0FBQztJQTdERCxzQkFBWSxrQ0FBTzthQUFuQjtZQUNJLE9BQU87Z0JBQ0gsWUFBWSxFQUFFLElBQUksQ0FBQyxhQUFhO2dCQUNoQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE9BQU87YUFDdkIsQ0FBQztRQUNOLENBQUM7OztPQUFBO0lBMERNLDhCQUFNLEdBQWIsVUFBYyxDQUFNLEVBQUUsQ0FBUTtRQUMxQixPQUFPLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRU0sNkJBQUssR0FBWixVQUFhLEVBQVMsRUFBRSxDQUFRLEVBQUUsRUFBTztRQUNyQyxPQUFPLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUNMLG9CQUFDO0FBQUQsQ0FBQyxBQTFFRCxJQTBFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElEYXRlcGlja2VyTG9jYWxlVmFsdWVzIH0gZnJvbSBcIi4uLy4uLy4uL2JlaGF2aW9ycy9sb2NhbGl6YXRpb24vaW5kZXhcIjtcbmltcG9ydCB7IGZvcm1hdCwgcGFyc2UgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcbmltcG9ydCAqIGFzIGRlZmF1bHRMb2NhbGUgZnJvbSBcImRhdGUtZm5zL2xvY2FsZS9lbi1VU1wiO1xuXG5pbnRlcmZhY2UgSURhdGVGbnNMb2NhbGVWYWx1ZXMge1xuICAgIFtuYW1lOnN0cmluZ106c3RyaW5nW107XG59XG5pbnRlcmZhY2UgSURhdGVGbnNIZWxwZXJPcHRpb25zIHtcbiAgICB0eXBlPzpzdHJpbmc7XG59XG50eXBlIERhdGVGbnNIZWxwZXI8VSwgVD4gPSAodmFsdWU6VSwgb3B0aW9uczpJRGF0ZUZuc0hlbHBlck9wdGlvbnMpID0+IFQ7XG50eXBlIERhdGVGbnNXZWVrU3RhcnRzT24gPSAwIHwgMSB8IDIgfCAzIHwgNCB8IDUgfCA2O1xuXG5pbnRlcmZhY2UgSURhdGVGbnNDdXN0b21Mb2NhbGUge1xuICAgIGxvY2FsaXplOntcbiAgICAgICAgd2Vla2RheTpEYXRlRm5zSGVscGVyPG51bWJlciwgc3RyaW5nPjtcbiAgICAgICAgd2Vla2RheXM6RGF0ZUZuc0hlbHBlcjxJRGF0ZUZuc0hlbHBlck9wdGlvbnMsIHN0cmluZ1tdPjtcbiAgICAgICAgbW9udGg6RGF0ZUZuc0hlbHBlcjxudW1iZXIsIHN0cmluZz47XG4gICAgICAgIG1vbnRoczpEYXRlRm5zSGVscGVyPElEYXRlRm5zSGVscGVyT3B0aW9ucywgc3RyaW5nW10+O1xuICAgICAgICB0aW1lT2ZEYXk6RGF0ZUZuc0hlbHBlcjxudW1iZXIsIHN0cmluZz47XG4gICAgICAgIHRpbWVzT2ZEYXk6RGF0ZUZuc0hlbHBlcjxJRGF0ZUZuc0hlbHBlck9wdGlvbnMsIHN0cmluZ1tdPjtcbiAgICB9O1xuICAgIG1hdGNoOntcbiAgICAgICAgd2Vla2RheXM6RGF0ZUZuc0hlbHBlcjxzdHJpbmcsIFJlZ0V4cE1hdGNoQXJyYXkgfCBudWxsPjtcbiAgICAgICAgd2Vla2RheT86RGF0ZUZuc0hlbHBlcjxSZWdFeHBNYXRjaEFycmF5LCBudW1iZXI+O1xuICAgICAgICBtb250aHM6RGF0ZUZuc0hlbHBlcjxzdHJpbmcsIFJlZ0V4cE1hdGNoQXJyYXkgfCBudWxsPjtcbiAgICAgICAgbW9udGg/OkRhdGVGbnNIZWxwZXI8UmVnRXhwTWF0Y2hBcnJheSwgbnVtYmVyPjtcbiAgICAgICAgdGltZXNPZkRheTpEYXRlRm5zSGVscGVyPHN0cmluZywgUmVnRXhwTWF0Y2hBcnJheSB8IG51bGw+O1xuICAgICAgICB0aW1lT2ZEYXk/OkRhdGVGbnNIZWxwZXI8UmVnRXhwTWF0Y2hBcnJheSwgbnVtYmVyPjtcbiAgICB9O1xuICAgIG9wdGlvbnM/OntcbiAgICAgICAgd2Vla1N0YXJ0c09uPzpudW1iZXI7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRMb2NhbGl6ZUZuKFxuICAgIHZhbHVlczpJRGF0ZUZuc0xvY2FsZVZhbHVlcyxcbiAgICBkZWZhdWx0VHlwZTpzdHJpbmcsXG4gICAgaW5kZXhDYWxsYmFjaz86KG9sZEluZGV4Om51bWJlcikgPT4gbnVtYmVyXG4pOkRhdGVGbnNIZWxwZXI8bnVtYmVyLCBzdHJpbmc+IHtcbiAgICByZXR1cm4gKGRpcnR5SW5kZXg6bnVtYmVyLCB7IHR5cGUgfSA9IHsgdHlwZTogZGVmYXVsdFR5cGUgfSkgPT4ge1xuICAgICAgICBjb25zdCBpbmRleCA9IGluZGV4Q2FsbGJhY2sgPyBpbmRleENhbGxiYWNrKGRpcnR5SW5kZXgpIDogZGlydHlJbmRleDtcbiAgICAgICAgLyogVGhlcmUgbWlnaHQgYmUgYSBiZXR0ZXIgd2F5IHRvIGZpeCB0aGlzIGVycm9yOlxuICAgICAgICAtLS0tXG4gICAgICAgIHNyYy9tb2R1bGVzL2RhdGVwaWNrZXIvaGVscGVycy9kYXRlLWZucy50czo0MzoyMyAtIGVycm9yIFRTMjUzODogVHlwZSAndW5kZWZpbmVkJyBjYW5ub3QgYmUgdXNlZCBhcyBhbiBpbmRleCB0eXBlLlxuXG4gICAgICAgIDQzICAgICAgICAgcmV0dXJuIHZhbHVlc1t0eXBlXVtpbmRleF07XG4gICAgICAgIC0tLS1cbiAgICAgICAgICAgIEhvd2V2ZXIsIHRoaXMgJ3x8IDEnIGNvZXJjaW9uIFwid29ya3NcIlxuICAgICAgICAqL1xuICAgICAgICByZXR1cm4gdmFsdWVzW3R5cGUgfHwgLTFdW2luZGV4XTtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZExvY2FsaXplQXJyYXlGbihcbiAgICB2YWx1ZXM6SURhdGVGbnNMb2NhbGVWYWx1ZXMsXG4gICAgZGVmYXVsdFR5cGU6c3RyaW5nXG4pOkRhdGVGbnNIZWxwZXI8SURhdGVGbnNIZWxwZXJPcHRpb25zLCBzdHJpbmdbXT4ge1xuICAgIHJldHVybiAoeyB0eXBlIH0gPSB7IHR5cGU6IGRlZmF1bHRUeXBlIH0pID0+IHZhbHVlc1t0eXBlIHx8IC0xXTtcbn1cblxuZnVuY3Rpb24gYnVpbGRNYXRjaEZuKFxuICAgIHBhdHRlcm5zOklEYXRlRm5zTG9jYWxlVmFsdWVzLFxuICAgIGRlZmF1bHRUeXBlOnN0cmluZ1xuKTpEYXRlRm5zSGVscGVyPHN0cmluZywgUmVnRXhwTWF0Y2hBcnJheSB8IG51bGw+IHtcbiAgICByZXR1cm4gKGRpcnR5U3RyaW5nLCB7IHR5cGUgfSA9IHsgdHlwZTogZGVmYXVsdFR5cGUgfSkgPT5cbiAgICAgICAgZGlydHlTdHJpbmcubWF0Y2goYF4oJHtwYXR0ZXJuc1t0eXBlIHx8IC0xXS5qb2luKFwifFwiKX0pYCk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkUGFyc2VGbihcbiAgICBwYXR0ZXJuczpJRGF0ZUZuc0xvY2FsZVZhbHVlcyxcbiAgICBkZWZhdWx0VHlwZTpzdHJpbmdcbik6RGF0ZUZuc0hlbHBlcjxSZWdFeHBNYXRjaEFycmF5LCBudW1iZXI+IHtcbiAgICByZXR1cm4gKFssIHJlc3VsdF0sIHsgdHlwZSB9ID0geyB0eXBlOiBkZWZhdWx0VHlwZSB9KSA9PlxuICAgICAgICAocGF0dGVybnNbdHlwZSB8fCAtMV0gfHwgcGF0dGVybnNbZGVmYXVsdFR5cGVdKVxuICAgICAgICAgICAgLm1hcCgocDpzdHJpbmcpID0+IG5ldyBSZWdFeHAoYF4ke3B9YCkpXG4gICAgICAgICAgICAuZmluZEluZGV4KChwYXR0ZXJuOlJlZ0V4cCkgPT4gcGF0dGVybi50ZXN0KHJlc3VsdCkpO1xufVxuXG5leHBvcnQgY2xhc3MgRGF0ZUZuc1BhcnNlciB7XG4gICAgcHJpdmF0ZSBfd2Vla1N0YXJ0c09uOkRhdGVGbnNXZWVrU3RhcnRzT247XG4gICAgcHJpdmF0ZSBfbG9jYWxlOklEYXRlRm5zQ3VzdG9tTG9jYWxlO1xuXG4gICAgcHJpdmF0ZSBnZXQgX2NvbmZpZygpOmFueSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3ZWVrU3RhcnRzT246IHRoaXMuX3dlZWtTdGFydHNPbixcbiAgICAgICAgICAgIGxvY2FsZTogdGhpcy5fbG9jYWxlXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IobG9jYWxlOklEYXRlcGlja2VyTG9jYWxlVmFsdWVzKSB7XG4gICAgICAgIHRoaXMuX3dlZWtTdGFydHNPbiA9IGxvY2FsZS5maXJzdERheU9mV2VlayBhcyBEYXRlRm5zV2Vla1N0YXJ0c09uO1xuXG4gICAgICAgIGNvbnN0IHdlZWtkYXlWYWx1ZXMgPSB7XG4gICAgICAgICAgICBsb25nOiBsb2NhbGUud2Vla2RheXMsXG4gICAgICAgICAgICBzaG9ydDogbG9jYWxlLndlZWtkYXlzU2hvcnQsXG4gICAgICAgICAgICBuYXJyb3c6IGxvY2FsZS53ZWVrZGF5c05hcnJvd1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG1vbnRoVmFsdWVzID0ge1xuICAgICAgICAgICAgbG9uZzogbG9jYWxlLm1vbnRocyxcbiAgICAgICAgICAgIHNob3J0OiBsb2NhbGUubW9udGhzU2hvcnRcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCB0aW1lT2ZEYXlWYWx1ZXMgPSB7XG4gICAgICAgICAgICBsb25nOiBsb2NhbGUudGltZXNPZkRheSxcbiAgICAgICAgICAgIHVwcGVyY2FzZTogbG9jYWxlLnRpbWVzT2ZEYXlVcHBlcmNhc2UsXG4gICAgICAgICAgICBsb3dlcmNhc2U6IGxvY2FsZS50aW1lc09mRGF5TG93ZXJjYXNlXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgdGltZU9mRGF5TWF0Y2hWYWx1ZXMgPSB7XG4gICAgICAgICAgICBsb25nOiBsb2NhbGUudGltZXNPZkRheSxcbiAgICAgICAgICAgIHNob3J0OiBsb2NhbGUudGltZXNPZkRheVVwcGVyY2FzZS5jb25jYXQobG9jYWxlLnRpbWVzT2ZEYXlMb3dlcmNhc2UpXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fbG9jYWxlID0gZGVmYXVsdExvY2FsZSBhcyBhbnk7XG4gICAgICAgIHRoaXMuX2xvY2FsZS5sb2NhbGl6ZSA9IHtcbiAgICAgICAgICAgIC4uLnRoaXMuX2xvY2FsZS5sb2NhbGl6ZSxcbiAgICAgICAgICAgIC4uLntcbiAgICAgICAgICAgICAgICB3ZWVrZGF5OiBidWlsZExvY2FsaXplRm4od2Vla2RheVZhbHVlcywgXCJsb25nXCIpLFxuICAgICAgICAgICAgICAgIHdlZWtkYXlzOiBidWlsZExvY2FsaXplQXJyYXlGbih3ZWVrZGF5VmFsdWVzLCBcImxvbmdcIiksXG4gICAgICAgICAgICAgICAgbW9udGg6IGJ1aWxkTG9jYWxpemVGbihtb250aFZhbHVlcywgXCJsb25nXCIpLFxuICAgICAgICAgICAgICAgIG1vbnRoczogYnVpbGRMb2NhbGl6ZUFycmF5Rm4obW9udGhWYWx1ZXMsIFwibG9uZ1wiKSxcbiAgICAgICAgICAgICAgICB0aW1lT2ZEYXk6IGJ1aWxkTG9jYWxpemVGbihcbiAgICAgICAgICAgICAgICAgICAgdGltZU9mRGF5VmFsdWVzLFxuICAgICAgICAgICAgICAgICAgICBcImxvbmdcIixcbiAgICAgICAgICAgICAgICAgICAgKGhvdXJzOm51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhvdXJzIC8gMTIgPj0gMSA/IDEgOiAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB0aW1lc09mRGF5OiBidWlsZExvY2FsaXplQXJyYXlGbih0aW1lT2ZEYXlWYWx1ZXMsIFwibG9uZ1wiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9sb2NhbGUubWF0Y2ggPSB7XG4gICAgICAgICAgICAuLi50aGlzLl9sb2NhbGUubWF0Y2gsXG4gICAgICAgICAgICAuLi57XG4gICAgICAgICAgICAgICAgd2Vla2RheXM6IGJ1aWxkTWF0Y2hGbih3ZWVrZGF5VmFsdWVzLCBcImxvbmdcIiksXG4gICAgICAgICAgICAgICAgd2Vla2RheTogYnVpbGRQYXJzZUZuKHdlZWtkYXlWYWx1ZXMsIFwibG9uZ1wiKSxcbiAgICAgICAgICAgICAgICBtb250aHM6IGJ1aWxkTWF0Y2hGbihtb250aFZhbHVlcywgXCJsb25nXCIpLFxuICAgICAgICAgICAgICAgIG1vbnRoOiBidWlsZFBhcnNlRm4obW9udGhWYWx1ZXMsIFwibG9uZ1wiKSxcbiAgICAgICAgICAgICAgICB0aW1lc09mRGF5OiBidWlsZE1hdGNoRm4odGltZU9mRGF5TWF0Y2hWYWx1ZXMsIFwibG9uZ1wiKSxcbiAgICAgICAgICAgICAgICB0aW1lT2ZEYXk6IGJ1aWxkUGFyc2VGbih0aW1lT2ZEYXlNYXRjaFZhbHVlcywgXCJsb25nXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGZvcm1hdChkOkRhdGUsIGY6c3RyaW5nKTpzdHJpbmcge1xuICAgICAgICByZXR1cm4gZm9ybWF0KGQsIGYsIHRoaXMuX2NvbmZpZyk7XG4gICAgfVxuXG4gICAgcHVibGljIHBhcnNlKGRTOnN0cmluZywgZjpzdHJpbmcsIGJEOkRhdGUpOkRhdGUge1xuICAgICAgICByZXR1cm4gcGFyc2UoZFMsIGYsIGJELCB0aGlzLl9jb25maWcpO1xuICAgIH1cbn1cbiJdfQ==